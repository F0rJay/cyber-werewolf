# 游戏规则说明

本文档说明 Cyber-Werewolf 实现的完整游戏规则。

## 游戏流程

### 1. 身份分配
- 随机分配身份给所有玩家
- 支持的角色：村民、狼人、预言家、女巫、守卫

### 2. 夜晚阶段
**行动顺序：**
1. **狼人和预言家先行动**
   - 狼人：在狼人频道发言，投票选择要杀的人（平票则从平票玩家中随机选一人攻击）
   - 预言家：选择一名玩家查验身份（只能知道是好人还是狼人，不能知道具体身份）
   
2. **守卫行动**
   - 选择一名玩家守护（不能连续两晚守护同一人）
   - 守卫只对狼人攻击有效，不能防御女巫毒药
   
3. **女巫后行动**
   - 如果有人被杀，可以选择使用解药救人
   - 可以使用毒药使一名玩家出局
   - 解药和毒药各只有一瓶，一回合只能用一瓶
   - 解药只有第一回合可以给自己用

### 3. 天亮阶段

#### 第一天特殊流程：
1. **警长竞选**
   - 玩家选择是否竞选警长（上警）
   - 不竞选者不可发言
   - 竞选者按随机顺序发言
   - **退水操作**：警上玩家可以在发言过程中退出竞选（称为"退水"）
   - **全部上警**：如果全部玩家都上警竞选，则本局失去警徽，没有警长

2. **警长投票**
   - 所有玩家投票给警长候选人
   - 票数多者当选
   - **平票处理**：
     - 第一轮平票：平票候选人进行PK发言，然后进行第二轮投票
     - 第二轮依然平票：本局没有警长，警徽流失

3. **公布出局玩家**
   - 公布昨晚出局的玩家
   - **遗言规则**：
     - 第一天夜里出局的玩家：有遗言
     - 其他天夜里出局的玩家：只能发动特殊技能，没有遗言

4. **发言阶段**
   - 警长选择发言顺序（如果有警长）
   - 按顺序发言
   - **自爆规则**：
     - 只有狼人可以自爆（与是否警长无关）
     - 如果狼人玩家当选警长，仍然可以自爆（因为他是狼人）
     - 自爆后立即出局，发言终止，直接进入黑夜

5. **放逐投票**
   - 所有玩家投票
   - 票数最多者被放逐
   - 平票处理：
     - 第一轮平票：平票玩家进行第二轮发言和投票
     - 第二轮依然平票：直接进入黑夜，无人出局

#### 其他天流程：
1. **公布出局玩家**
2. **发言阶段**（警长选择顺序）
3. **放逐投票**

### 4. 循环
- 夜晚 → 天亮 → 发言 → 投票 → 夜晚
- 直到游戏结束

## 角色特殊能力

### 狼人
- **天黑**：可以在狼人频道发言，可见其他狼人
- **投票杀人**：投票选择要杀的人（平票或无人投票则平安夜）
- **自爆**：天亮期间可随时自爆，终止其他玩家发言，直接进入黑夜
- **黑夜杀狼**：黑夜期间可以投票杀掉狼人（特殊规则）

### 预言家
- **查验**：天黑可以选择一名玩家查看身份，一回合只能查看一个

### 女巫
- **解药**：如果有人被杀，可以选择使用解药救活
  - 如果没有人被杀，则不能使用解药
  - 只有第一回合可以给自己用
- **毒药**：可以使用毒药使一名玩家出局
  - **不能给自己用**
- **限制**：只有一瓶解药和一瓶毒药，一回合只能用一瓶

### 守卫
- **守护**：每晚可以守护一名玩家
- **限制**：不能连续两晚守护同一名玩家
- **效果**：被守护的玩家当晚不会被狼人杀害
- **特殊规则**：
  1. 守卫不能防御女巫的毒药
  2. 守卫守了被女巫解救的目标，该目标在第二天会出局

## 胜负规则（屠边）

游戏采用**屠边规则**：

- **好人获胜**：狼人全部出局
- **狼人获胜**：满足以下任一条件
  - 平民全部出局
  - 神职全部出局

## 特殊机制

### 自爆机制
- 只有狼人可以自爆
- 警长不能自爆（即使警长是狼人）
- 自爆后立即出局，终止其他玩家发言，直接进入黑夜

### 平票机制
- **第一轮平票**：平票的玩家进行第二轮发言和投票，得票最多者出局
- **第二轮依然平票**：直接进入黑夜，无人出局

### 警长机制
- **第一天竞选**：玩家选择是否上警竞选
- **退水操作**：警上玩家可以在发言过程中退出竞选
- **全部上警**：如果全部玩家都上警，则本局失去警徽，没有警长
- **警长投票**：
  - 所有玩家投票给警长候选人
  - 第一轮平票：平票候选人进行PK发言，然后第二轮投票
  - 第二轮依然平票：本局没有警长，警徽流失
- **警长功能**：
  - 警长可以选择发言顺序
  - **警长不能自爆**（即使警长是狼人）
  - **警长移交机制**：
    - 警长出局后（夜里出局或被放逐），需要决定如何处理警徽
    - 可以选择将警徽移交给其他存活玩家（该玩家成为新警长）
    - 或者选择销毁警徽（不移交，本局没有警长）
    - 移交决策由 LLM 智能决策

## 实现状态

### ✅ 已实现
- 身份随机分配
- 夜晚阶段基本流程
- 警长竞选和投票
- 发言阶段（支持自爆）
- 放逐投票（支持平票重议）
- 屠边规则判定
- 警长移交机制：警长出局后可以移交警徽或销毁（LLM 决策）
- 遗言系统：第一天夜里出局和放逐的玩家有遗言（LLM 生成）

### 🚧 待完善
- Agent 集成（发言、投票、行动决策）
- 完整的技能系统（女巫解药/毒药、守卫守护、预言家查验）
- 特殊技能发动（夜里出局玩家的技能）
- 狼人频道发言
- 自爆的完整实现

